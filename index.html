<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Jeu VR - Tire sur les canards ðŸ¦†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-event-set-component@5.0.0/dist/aframe-event-set-component.min.js"></script>
</head>
<body style="margin: 0;">
  <a-scene vr-mode-ui="enabled: true">

    <!-- CamÃ©ra + curseur -->
    <a-entity id="cameraRig" camera look-controls position="0 1.6 0">
      <a-entity id="cursor"
                cursor="rayOrigin: entity" raycaster="objects: .clickable"
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.01; radiusOuter: 0.02"
                material="color: white; shader: flat">
      </a-entity>
    </a-entity>

    <!-- Fond panoramique -->
    <a-sky id="sky" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg"></a-sky>

    <!-- Score affichÃ© -->
    <a-text id="scoreText" value="Score: 0" position="-0.6 2 -1" color="white" width="3"></a-text>

    <!-- Container des canards -->
    <a-entity id="duckContainer"></a-entity>

    <!-- Menu emojis arrondi -->


  </a-scene>

  <script>
    let score = 0;
    let duckIdCounter = 0;
    let ducks = [];

    function updateScore() {
      document.querySelector('#scoreText').setAttribute('value', `Score: ${score}`);
    }

    function createDuck(x, y, z) {
      const duck = document.createElement('a-entity');
      duck.setAttribute('id', `duck${duckIdCounter++}`);
      duck.setAttribute('class', 'clickable duck');
      duck.setAttribute('gltf-model', 'https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/refs/heads/main/2.0/Duck/glTF/Duck.gltf');
      duck.setAttribute('position', `${x} ${y} ${z}`);
      duck.setAttribute('scale', '0.3 0.3 0.3');
      duck.setAttribute('animation-mixer', '');
      document.querySelector('#duckContainer').appendChild(duck);

      // Animation permanente de dÃ©placement en aller-retour
      const dx = (Math.random() - 0.5) * 4;
      const dz = (Math.random() - 0.5) * 4;
      duck.setAttribute('animation__x', {
        property: 'position',
        dir: 'alternate',
        dur: 4000 + Math.random() * 2000,
        easing: 'linear',
        loop: true,
        to: `${x + dx} ${y} ${z + dz}`
      });

      duck.addEventListener('click', () => {
        duck.remove();
        ducks = ducks.filter(d => d !== duck);
        score++;
        updateScore();
        if (ducks.length === 0) {
          setTimeout(spawnDucks, 1000);
        }
      });

      ducks.push(duck);
    }

    function spawnDucks() {
      const num = Math.floor(Math.random() * 4) + 2; // entre 2 et 5
      for (let i = 0; i < num; i++) {
        const x = (Math.random() - 0.5) * 4;
        const y = 1 + Math.random() * 0.5;
        const z = -2 - Math.random() * 3;
        createDuck(x, y, z);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateScore();
      spawnDucks();

      document.querySelector('#scene1').addEventListener('click', () => {
        document.querySelector('#sky').setAttribute('src', 'https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg');
      });

      document.querySelector('#scene2').addEventListener('click', () => {
        document.querySelector('#sky').setAttribute('src', 'https://cdn.aframe.io/360-video-boilerplate/video/city.mp4');
      });
    });

    // Capteurs iOS
    window.addEventListener('click', function () {
      if (typeof DeviceOrientationEvent !== 'undefined' &&
          typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
          .then(response => {
            if (response !== 'granted') alert('Permission capteur refusÃ©e');
          })
          .catch(console.error);
      }
    });
  </script>
</body>
</html>
