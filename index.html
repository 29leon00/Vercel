<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Jeu VR - Tir sur Canards ðŸ¦†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/super-hands@4.0.5/dist/aframe-super-hands.min.js"></script>
</head>
<body style="margin: 0;">
  <a-scene>
    <!-- CamÃ©ra + main + curseur -->
    <a-entity id="cameraRig" position="0 1.6 0">
      <a-entity id="camera" camera look-controls position="0 0 0"></a-entity>

      <!-- Main avec pistolet -->
      <a-entity id="hand" position="0.3 -0.5 -0.8" rotation="0 0 0">
        <a-box id="gun" color="black" depth="0.3" height="0.1" width="0.2" position="0 0 0"></a-box>
      </a-entity>
    </a-entity>

    <!-- Fond panoramique -->
    <a-sky id="sky" src="https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg"></a-sky>

    <!-- Score affichÃ© -->
    <a-text id="scoreText" value="Score: 0" position="-0.6 2 -1" color="white" width="3"></a-text>

    <!-- Menu emojis -->


    <!-- Canards (placÃ©s dynamiquement) -->
    <a-entity id="duck-container"></a-entity>
  </a-scene>

  <script>
    const duckModel = "https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/refs/heads/main/2.0/Duck/glTF/Duck.gltf";
    const duckCount = 3;
    let score = 0;
    let ducksRemaining = duckCount;

    // Ajouter un projectile (balle)
    function shootProjectile() {
      const scene = document.querySelector("a-scene");
      const camera = document.querySelector("#camera");

      const bullet = document.createElement("a-sphere");
      bullet.setAttribute("radius", "0.03");
      bullet.setAttribute("color", "yellow");
      bullet.setAttribute("position", camera.object3D.position);
      bullet.setAttribute("velocity", getCameraDirection().multiplyScalar(5));
      bullet.setAttribute("dynamic-body", "mass: 0.1;");

      bullet.classList.add("projectile");

      bullet.addEventListener("collide", function (e) {
        const duck = e.detail.body.el;
        if (duck && duck.classList.contains("duck")) {
          // Supprime canard
          duck.parentNode.removeChild(duck);
          ducksRemaining--;
          score++;
          document.querySelector("#scoreText").setAttribute("value", `Score: ${score}`);

          if (ducksRemaining <= 0) {
            setTimeout(spawnDucks, 1000);
          }
        }
        // Supprimer projectile aprÃ¨s impact
        bullet.parentNode.removeChild(bullet);
      });

      scene.appendChild(bullet);
    }

    // Fonction pour obtenir la direction de la camÃ©ra
    function getCameraDirection() {
      const direction = new THREE.Vector3();
      document.querySelector("#camera").object3D.getWorldDirection(direction);
      return direction;
    }

    // CrÃ©er les canards Ã  des positions alÃ©atoires
    function spawnDucks() {
      const container = document.getElementById("duck-container");
      container.innerHTML = "";
      ducksRemaining = duckCount;

      for (let i = 0; i < duckCount; i++) {
        const duck = document.createElement("a-entity");
        duck.setAttribute("gltf-model", duckModel);
        duck.setAttribute("scale", "0.3 0.3 0.3");
        duck.setAttribute("position", `${(Math.random() - 0.5) * 4} ${1 + Math.random()} ${-2 - Math.random() * 3}`);
        duck.setAttribute("class", "duck");
        duck.setAttribute("static-body", "");
        container.appendChild(duck);
      }
    }

    // Initialisation du jeu
    document.addEventListener("DOMContentLoaded", () => {
      spawnDucks();

      document.addEventListener("click", () => {
        shootProjectile();
      });

      // Menu changement de fond
      document.querySelector("#scene1").addEventListener("click", () => {
        document.querySelector("#sky").setAttribute("src", "https://cdn.aframe.io/360-image-gallery-boilerplate/img/sechelt.jpg");
      });
      document.querySelector("#scene2").addEventListener("click", () => {
        document.querySelector("#sky").setAttribute("src", "https://cdn.aframe.io/360-video-boilerplate/video/city.mp4");
      });
    });
  </script>
</body>
</html>
